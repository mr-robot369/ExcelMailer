{% extends "base.html" %}
{% block title %}Email Logs | ExcelMailer{% endblock %}

{% block content %}
<div class="container pb-5">

    <div class="row align-items-center mb-5">
        <div class="col-md-6">
            <h6 class="text-primary text-uppercase fw-bold ls-1 mb-2">Audit Trail</h6>
            <h1 class="fw-800 display-6 mb-1 text-white">Email <span class="text-gradient">Activity Logs</span></h1>
            <p class="text-muted">Track and export document distribution events in real-time.</p>
        </div>
        <div class="col-md-6 text-md-end mt-3 mt-md-0">
            <div class="d-flex flex-wrap gap-2 justify-content-md-end">
                <a href="{% url 'export_email_logs' %}" class="btn btn-outline-success-custom rounded-pill px-4">
                    <i class="fa-solid fa-file-csv me-2"></i> Export CSV
                </a>
                <a href="{% url 'dashboard' %}" class="btn btn-outline-glass rounded-pill px-4">
                    <i class="fa-solid fa-arrow-left me-2"></i> Back
                </a>
            </div>
        </div>
    </div>

    {% if messages %}
        {% for message in messages %}
            <div class="alert custom-alert mb-4">
                <i class="fa-solid fa-circle-info me-2"></i> {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    <div class="glass-card-table shadow-lg">
        <div class="table-responsive">
            <table class="table table-dark-custom mb-0">
                <thead>
                    <tr>
                        <th class="ps-4">Recipient</th>
                        <th>Resource</th>
                        <th>Format</th>
                        <th>Status</th>
                        <th>Timestamp</th>
                        <th class="pe-4 text-end">Details</th>
                    </tr>
                </thead>
                <tbody>
                    {% for log in logs %}
                    <tr>
                        <td class="ps-4">
                            <div class="d-flex align-items-center">
                                <div class="log-icon me-3">
                                    <i class="fa-solid fa-envelope-open-text"></i>
                                </div>
                                <div>
                                    <div class="text-white fw-500">{{ log.recipient_email }}</div>
                                    <div class="smaller text-muted opacity-50">Sent to Member</div>
                                </div>
                            </div>
                        </td>
                        <td>
                            <code class="sheet-badge small">{{ log.sheet_name }}</code>
                        </td>
                        <td>
                            <span class="badge bg-opacity-10 {% if log.send_type == 'pdf' %}bg-info text-info{% else %}bg-primary text-primary{% endif %} rounded-pill px-3 py-2 smaller">
                                <i class="fa-solid {% if log.send_type == 'pdf' %}fa-file-pdf{% else %}fa-file-excel{% endif %} me-1"></i>
                                {{ log.send_type|upper }}
                            </span>
                        </td>
                        <td>
                            {% if log.status == "success" %}
                                <span class="status-indicator">
                                    <span class="dot"></span> Delivered
                                </span>
                            {% else %}
                                <span class="status-indicator error">
                                    <span class="dot"></span> Failed
                                </span>
                            {% endif %}
                        </td>
                        <td>
                            <div class="small text-muted">
                                <div class="text-white-50">{{ log.sent_at|date:"M d, Y" }}</div>
                                <div class="opacity-50 smaller">{{ log.sent_at|date:"H:i:s" }}</div>
                            </div>
                        </td>
                        <td class="pe-4 text-end">
                            {% if log.error_message %}
                                <span class="text-danger small fw-bold" title="{{ log.error_message }}" style="cursor:help;">
                                    <i class="fa-solid fa-circle-exclamation me-1"></i> View Error
                                </span>
                            {% else %}
                                <span class="text-success small opacity-75">
                                    <i class="fa-solid fa-circle-check me-1"></i> Verified
                                </span>
                            {% endif %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="text-center py-5">
                            <div class="opacity-25 mb-3 text-white">
                                <i class="fa-solid fa-list-check fa-3x"></i>
                            </div>
                            <p class="text-muted">No distribution history recorded yet.</p>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}